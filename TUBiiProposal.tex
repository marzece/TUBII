\documentclass[letter, 11pt]{article}
\usepackage{graphicx}
\usepackage{rotating}
\usepackage{xspace}
%\setlength{\topmargin}{-0.5in}
\usepackage[top=1.in, bottom=1.5in, left = 1in, right=1in]{geometry}

\setlength{\parindent}{0.0in}


\title{TUBii Proposal \\ \small{ver 3.8}}
\date{\today}

\begin{document}

\maketitle
\tableofcontents

\section{Requirements: aka Designer's Paradise}

In roughly priority order:
\begin{enumerate}
\item Communication with the CAEN board

\begin{itemize}
\item GT: ECL to NIM conversion to trigger the CAEN board
\item SYNC and SYNC24: ECL to LVDS conversion to flag bits in the CAEN header for synchronisation with PMT bundled events
\item External Trig: NIM to ECL conversion for synchronisation
\end{itemize}

\item Delayed GT

For the MTCA+.

$\rightarrow$ One 8-bit register to program the delay counter.

\item Generic programmable delays

\begin{itemize}
\item Synchronous
\item Semi-asynchronous i.e. using a higher rate clock
\item Truly asynchronous
\end{itemize}

$\rightarrow$ One 8-bit register per delay to program delay counter.

$??$ How many delays?

$??$ What range of $\Delta T$?

\item Ext Trig fan-in

\begin{itemize}
\item Fan in of additional external trigger signals to a single spigot on the MTCD
\item Latching of new external triggers in sync with MTCD
\item Programmable trigger mask for new ext triggers
\item Fan in of external async triggers (EXTASY+)
\end{itemize}

\item Clock options

\begin{itemize}
\item  External input of TUB clock
\item  New clock: 200MHz LVPECL
\item OR of above:

Default: new clock \\
Switch in TUB clock if:
\begin{itemize}
\item   $n$ clock ticks missed
\item manually
\item ORCA controlled
\end{itemize}

\item LED to ID clock
\item Bit stored in register (written to datastream?) to identify clock

\end{itemize}

$\rightarrow$ One 8-bit register to program counter for controlling clock switch-over.

\item Communication with ELLIE

\begin{itemize}
\item Synchronous pulse generation to drive ELLIE: 1~HZ --- 10~kHz
\item Return pulse delay $\sim$600~ns
\end{itemize}

$\rightarrow$ Three 8-bit registers for pulse generation.

$\rightarrow$ One 8-bit register for delay.

\item ECAL set-up
AND of GT with a control signal, fed back into the ExtPed (with a fan-in to allow something else to be connected?)

\item Translations

\begin{itemize}
\item ECL to TTL
\item TTL to ECL
\item ECL to NIM
\item NIM to ECL
\item ECL to LVDS
\item LVDS to ECL
\item Other?
\end{itemize}

\item Additional trigger options

\begin{itemize}
\item Prescale trigger
\item Burst trigger
\item Sychronous trigger (``TUBii GT'')
\end{itemize}

\item Pulse generation

\begin{itemize}
\item Synchronous
\item Semi-asynchronous (higher rate clock)
\item Truly asynchronous
\end{itemize}

$\rightarrow$ Three 8-bit registers for synchronous pulse generation (per instance).

$\rightarrow$ One 8-bit register for semi-async / truly async delay to sync pulses (per instance).

$??$ How many instances?

$??$ Do semi/truly-async by generating sync pulses and delaying them..?

\item Tunable retriggerable discriminator circuit

\begin{itemize}
\item Trigger using DIY ECL one-shot (F/F + RC delay a-la-Klein)
\item Maximise dynamic range (V)
\item Minimise time delay (ns)
\item Retriggerable: on DGT AND LO*
\item Allow for neg- and pos-going pulses -- use differential comparator output $\rightarrow$ 2 circuits
\end{itemize}

2 options:
\begin{enumerate}
\item $[-3.3, +5]$ V range ; 2.5~ns delay on comparator (6.5~ns total)
\item $[-2.0, +3]$ V range ; 250~ps delay on comparator (4.25~ns total)
\end{enumerate}



\item Pulse Inverter

\item Pulse Scaler

\item Speaker
Equivalent to TUB plus
\begin{itemize}
\item option to listen to individual triggers
\item listen to analogue trig sum??
\item prescale
\item audio filter
\end{itemize}

\item LEDs
Pretty colours

\item Gated charge run set-up

\item Powers: -5.2V, -2V, +3.3V, +5V

\item Ribbon cable delay

\item ML403...

\end{enumerate}


\section{ML403}
\subsection{Minimal requirements}
 Ethernet communication with ORCA a la XL3, allowing remote control of TUBii settings, which requires:
\begin{itemize}
\item Data bus on TUBii
\item Registers to hold info
\item input- and output-enable lines to load/read registers
\end{itemize}

\subsection{Preferred Capabilities}
Inclusion of TUBii info in datastream, which requires:
\begin{itemize}
\item GT counter on ML403 to keep events in sync
\item Redundancy check on event count..??  Ideas:
\begin{itemize}
\item SYNC and SYNC24 already come onto TUBii: check every $2^{16}$ and $2^{24}$ event
\item ??
\end{itemize}
\end{itemize}

\subsubsection{ML403 Processing Requirements}
\begin{enumerate}
\item GT counting to mimic CMOS chips (including missed GTs etc)
\item Ext trigger processing
\begin{itemize}
\item Apply trigger mask to external trigger signals
\item Generate raw trig (if required)
\item latch ext trig signals on receipt of LatchedRawTrig signal
\item \it{Is this fast enough using direct i/o, or does it need to be discretes?}
\end{itemize}
\item Prescale triggers
\begin{itemize}
\item Generate output raw trig for every $n^{th}$ input raw trig
\end{itemize}
\item Burst triggers
\begin{itemize}
\item Generate output raw trigs for each input raw trig during a fixed window of $T$~ns (equiv to $N$ clock ticks)
\end{itemize}
\item ECAL
\begin{itemize}
\item AND of GT with control signal
\end{itemize}
\item Additional programmable delays
\begin{itemize}
\item Generate output pulse $m$ clock ticks after input pulse (sync to TUBii clock?) 
\end{itemize}
\item Combined Trigger Logic
\begin{itemize}
\item Option to generate raw trigs on specified combination of other trigger signals?
\end{itemize}
\item MTCA+ threshold monitoring
\begin{itemize}
\item Not sure how we do this yet...
\end{itemize}


\end{enumerate}


\subsubsection{Info to be included in datastream}

\begin{enumerate}
\item GT count
\item Ext Trig signals
\begin{itemize}
\item Mask for new ext trigger signals
\item TUBii trigger word (of ext trig signals)
\end{itemize}
\item Prescale triggers
\begin{itemize}
\item Prescale factor per trigger
\end{itemize}
\item Burst triggers
\begin{itemize}
\item Burst length
\item Burst frequency
\end{itemize}
\item Additional programmable delays
\begin{itemize}
\item Delay period
\end{itemize}

\item Clock ID bit
\end{enumerate}

\subsection{Dream-like Ambitions}
\begin{itemize}
\item LCD screen displaying funky stuff (GT count, captain neutrino, ext trig word...)
\end{itemize}

\subsection{ML403 I/O Pin Count}

32 pins will be used as bus I/O, with registers to set counters etc.  This will be used for anything that only needs to be set once per run, or is not time critical.

Individual pins will be used for anything that needs to be synchronous with the clock, or needs to be prompt $i.e.$ we don't want the additional delay of a register.

\begin{table}[htdp]
\begin{center}
\begin{tabular}{l|c|c}
\bf{Purpose} & \bf{I/O} & \bf{Pins}\\
\hline \hline
GT & I & 1 \\
Ext trig signals & I & 16 \\
Latched raw trig & I & 1 \\
Ext raw trig & O & 1 \\
Trigger signals for prescale & I & 4 \\
Prescaled triggers & O & 4 \\
Trigger signals for burst & I & 4 \\
\it{Same inputs as prescale trigs?} &&\\
Bursted triggers & O & 4 \\
\it{Same outputs as prescale?}&&\\
ECAL validation signal & O & 1 \\
Trigger signals for combination & I & 4 \\
\it{Same as prescale / burst inputs?}&&\\
Combo raw trig & O & 1 \\
Delayable pulse & I & 2 \\
Delayed pulse & O & 2 \\
&&\\
TUBii clock? & I & 2\\
&&\\
Do we need any for th monitoring?&&\\
&&\\
Registers / Data bus & IO & 32 \\
\it{Inc all counter settings etc}&&\\
Addresses & O & 4 \\

\hline \hline
\bf{Total} && \bf{83+} \\
\end{tabular}
\end{center}
\end{table}%


\section{Front Panel}

\begin{itemize}
\item Connector translations (BNC, SMB, LEMO)
\item Cable delay
\item All necessary I/O for everything mentioned above (that's a lot - I haven't made the full list yet, since it keeps expanding, but suffice to say TUBii won't be losing weight anytime soon).
\item ... 
\item Infinite other stuff.
\end{itemize}


\end{document}